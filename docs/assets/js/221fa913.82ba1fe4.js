"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[957],{9416:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return d},toc:function(){return p}});var a=n(8427),r=n(4397),i=(n(2784),n(876)),o=["components"],s={sidebar_position:4,sidebar_label:"useAsyncState"},l="useAsyncState",d={unversionedId:"api/use-async-state",id:"api/use-async-state",title:"useAsyncState",description:"The useAsyncState hook",source:"@site/docs/api/4-use-async-state.md",sourceDirName:"api",slug:"/api/use-async-state",permalink:"/react-async-states/docs/api/use-async-state",draft:!1,editUrl:"https://github.com/incepter/react-async-states/edit/main/packages/docs/docs/api/4-use-async-state.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,sidebar_label:"useAsyncState"},sidebar:"tutorialSidebar",previous:{title:"AsyncStateProvider",permalink:"/react-async-states/docs/api/provider"},next:{title:"useSelector",permalink:"/react-async-states/docs/api/use-selector"}},u={},p=[{value:"The <code>useAsyncState</code> hook",id:"the-useasyncstate-hook",level:2},{value:"Standalone vs Provider",id:"standalone-vs-provider",level:3},{value:"Subscription modes",id:"subscription-modes",level:3},{value:"Configuration and manipulation",id:"configuration-and-manipulation",level:2},{value:"Examples",id:"examples",level:2},{value:"<code>useAsyncState</code> configuration",id:"useasyncstate-configuration",level:2},{value:"<code>string</code> as the <code>key</code>",id:"string-as-the-key",level:3},{value:"<code>Source</code> object",id:"source-object",level:3},{value:"<code>Producer</code> function",id:"producer-function",level:3},{value:"<code>Configuration</code> object",id:"configuration-object",level:2},{value:"<code>key</code>",id:"key",level:3},{value:"<code>producer</code>",id:"producer",level:3},{value:"<code>initialValue</code>",id:"initialvalue",level:3},{value:"<code>source</code>",id:"source",level:3},{value:"<code>condition</code>",id:"condition",level:3},{value:"<code>lane</code>",id:"lane",level:3},{value:"<code>lazy</code>",id:"lazy",level:3},{value:"<code>fork</code>",id:"fork",level:3},{value:"<code>forkConfig</code>",id:"forkconfig",level:3},{value:"<code>hoistToProvider</code>",id:"hoisttoprovider",level:3},{value:"<code>hoistToProviderConfig</code>",id:"hoisttoproviderconfig",level:3},{value:"<code>selector</code>",id:"selector",level:3},{value:"<code>areEqual</code>",id:"areequal",level:3},{value:"<code>runEffect</code>",id:"runeffect",level:3},{value:"<code>runEffectDurationMs</code>",id:"runeffectdurationms",level:3},{value:"<code>skipPendingDelayMs</code>",id:"skippendingdelayms",level:3},{value:"<code>resetStateOnDispose</code>",id:"resetstateondispose",level:3},{value:"<code>cacheConfig</code>",id:"cacheconfig",level:3},{value:"<code>events</code>",id:"events",level:3},{value:"<code>subscribe</code>",id:"subscribe",level:4},{value:"<code>change</code>",id:"change",level:4},{value:"<code>useAsyncState</code> dependencies",id:"useasyncstate-dependencies",level:2},{value:"<code>useAsyncState</code> return value",id:"useasyncstate-return-value",level:2},{value:"<code>key</code>",id:"key-1",level:3},{value:"<code>source</code>",id:"source-1",level:3},{value:"<code>uniqueId</code>",id:"uniqueid",level:3},{value:"<code>mode</code>",id:"mode",level:3},{value:"<code>state</code>",id:"state",level:3},{value:"<code>read</code>",id:"read",level:3},{value:"<code>run</code>",id:"run",level:3},{value:"<code>abort</code>",id:"abort",level:3},{value:"<code>invalidateCache</code>",id:"invalidatecache",level:3},{value:"<code>mergePayload</code>",id:"mergepayload",level:3},{value:"<code>replaceState</code>",id:"replacestate",level:3},{value:"<code>lastSuccess</code>",id:"lastsuccess",level:3},{value:"Other hooks",id:"other-hooks",level:2}],c={toc:p};function m(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"useasyncstate"},(0,i.kt)("inlineCode",{parentName:"h1"},"useAsyncState")),(0,i.kt)("h2",{id:"the-useasyncstate-hook"},"The ",(0,i.kt)("inlineCode",{parentName:"h2"},"useAsyncState")," hook"),(0,i.kt)("p",null,"This hook allows subscription to an async state, and represents the API that\nyou will be interacting with the most."),(0,i.kt)("p",null,"Its signature is:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function useAsyncState(configuration, dependencies) {}\n")),(0,i.kt)("p",null,"It returns an object that contains few properties, we'll explore them in a moment."),(0,i.kt)("h3",{id:"standalone-vs-provider"},"Standalone vs Provider"),(0,i.kt)("p",null,"This hooks may be used inside and outside the provider and has almost the same behavior."),(0,i.kt)("p",null,"For example, you can use this hook to fetch the current user from your api before mounting the provider and pass the user\ninformation to payload."),(0,i.kt)("p",null,"When outside provider, it will expect you to use a producer function as configuration, or with an object defining\nthe producer and all other necessary information, or eventually a ",(0,i.kt)("inlineCode",{parentName:"p"},"Source")," object.."),(0,i.kt)("h3",{id:"subscription-modes"},"Subscription modes"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState")," hooks performs a subscription to an object from a constructor\ncalled ",(0,i.kt)("inlineCode",{parentName:"p"},"AsyncState"),", that's why it has this on its name. But in reality it may\nbe synchronous, so if I were to give it a new name, it would be ",(0,i.kt)("inlineCode",{parentName:"p"},"useSharedState"),"\nor ",(0,i.kt)("inlineCode",{parentName:"p"},"useBetterState"),"."),(0,i.kt)("p",null,"Many subscription modes are possible. You won't have to use them,\nbut you should essentially know what they mean and how your configuration\nimpacts them for debugging purposes."),(0,i.kt)("p",null,"What is a subscription mode already ?\nWhen you call ",(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState")," -every time your component renders- this hook\nreacts to the given configuration synchronized by your dependencies.\nThen, tries to get the async state instance from the provider or the source,\nor create a new one."),(0,i.kt)("p",null,"If not found, it may wait for it if you did not provide a ",(0,i.kt)("inlineCode",{parentName:"p"},"producer")," function\nin your configuration, or fallback with a noop mode for example."),(0,i.kt)("p",null,"The possible subscription mode are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"LISTEN"),": Listens to an existing async state from its key"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"HOIST"),": Registers the async state in the provider, and subscribes to it (more like an injection)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"STANDALONE"),": Mimics the standalone mode"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"FORK"),": Fork an existing async state in the provider"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"WAITING"),": When the desired async state does not exist in provider, and you do not want to hoist it"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SOURCE"),": When you use a source object for subscription"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SOURCE_FORK"),": When you use a source object for subscription and you decide to fork it"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"OUTSIDE_PROVIDER"),": When you call it outside the async state context provider"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"NOOP"),": If none of the above matches, should not happen")),(0,i.kt)("p",null,"Read more in ",(0,i.kt)("a",{parentName:"p",href:"/docs/faq/how-the-library-works#how-useasyncstate-subscription-mode-works-"},"this link"),"."),(0,i.kt)("h2",{id:"configuration-and-manipulation"},"Configuration and manipulation"),(0,i.kt)("p",null,"The configuration argument may be a string, an object with supported properties,\nor a producer function."),(0,i.kt)("p",null,"If it is a string, it is used inside provider to only listen on an async state."),(0,i.kt)("p",null,"If an object is provided, it may act like a simple subscription or a\nregistration of a new async state (with fork/hoist)."),(0,i.kt)("p",null,"Let's see in details the supported configuration:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Property"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Default Value"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"key")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"string")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"string")),(0,i.kt)("td",{parentName:"tr",align:null},"The key of the async state we are defining, subscribing to or forking from")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"lazy")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"boolean")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"true")),(0,i.kt)("td",{parentName:"tr",align:null},"If false, the subscription will re-run every dependency change")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"lane")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"string")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"undefined")),(0,i.kt)("td",{parentName:"tr",align:null},"If provided, the subscription will occur to a state Lane, and not the default state")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"fork")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"boolean")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"false")),(0,i.kt)("td",{parentName:"tr",align:null},"If true, subscription will fork the state")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"source")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"object")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"undefined")),(0,i.kt)("td",{parentName:"tr",align:null},"A source object, similar to the one created by ",(0,i.kt)("inlineCode",{parentName:"td"},"createSource"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"producer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"function")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"undefined")),(0,i.kt)("td",{parentName:"tr",align:null},"The producer function")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"selector")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"function")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"identity")),(0,i.kt)("td",{parentName:"tr",align:null},"receives state (",(0,i.kt)("inlineCode",{parentName:"td"},"{data, args, status}"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"lastSuccess"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"cache"),") and returns the ",(0,i.kt)("inlineCode",{parentName:"td"},"state")," property of the result value")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"areEqual")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"function")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"shallowEqual")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(prevState, nextState) => areEqual(prevState, nextState)")," determines whether the subscription should update or not")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"condition")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"boolean")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"true")),(0,i.kt)("td",{parentName:"tr",align:null},"If this condition is falsy, the automatic run isn't granted. this works only when ",(0,i.kt)("inlineCode",{parentName:"td"},"lazy = false"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"forkConfig")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ForkConfig")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"{keepState: false, keepCache: false}")),(0,i.kt)("td",{parentName:"tr",align:null},"The fork configuration in case of ",(0,i.kt)("inlineCode",{parentName:"td"},"fork = true"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"cacheConfig")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"CacheConfig")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"undefined")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines the cache config for the producer")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"runEffect")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"RunEffect")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"undefined")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines run effect to decorate the producer with: debounce, throttle, delay...")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"runEffectDurationMs")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"number > 0")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"undefined")),(0,i.kt)("td",{parentName:"tr",align:null},"The duration of the effect in milliseconds")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"resetStateOnDispose")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"boolean")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"true")),(0,i.kt)("td",{parentName:"tr",align:null},"Whether to reset the state to its initial state when all subscribers unsubscribe or to keep it. Default to ",(0,i.kt)("inlineCode",{parentName:"td"},"true"),".")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"skipPendingDelayMs")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"number > 0")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"undefined")),(0,i.kt)("td",{parentName:"tr",align:null},"The duration under which a state update with a pending status may be skipped. The component in this case won't render with a pending status if it gets updated to something else under that delay.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"initialValue")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"any")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"null")),(0,i.kt)("td",{parentName:"tr",align:null},"The initial producer value, useful only if working as standalone(ie defining own producer)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"events")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"UseAsyncStateEvents")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"undefined")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines events that will be invoked with this subscription.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"hoistToProvider")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"boolean")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"false")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines whether to hoist this state to the provider or not")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"hoistToProviderConfig")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"HoistConfig")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"{override: false}")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines the configuration associated with ",(0,i.kt)("inlineCode",{parentName:"td"},"hoistToProvider = true"))))),(0,i.kt)("p",null,"The returned object from ",(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState")," contains the following properties:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Property"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"key")),(0,i.kt)("td",{parentName:"tr",align:null},"The key of the async state subscribed instance")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"run")),(0,i.kt)("td",{parentName:"tr",align:null},"Runs the ",(0,i.kt)("inlineCode",{parentName:"td"},"Producer")," associated with the subscription")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"mode")),(0,i.kt)("td",{parentName:"tr",align:null},"The subscription mode")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"read")),(0,i.kt)("td",{parentName:"tr",align:null},"This function supports React's concurrent suspense and suspends the component if its status is ",(0,i.kt)("inlineCode",{parentName:"td"},"pending"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"state")),(0,i.kt)("td",{parentName:"tr",align:null},"The current selected portion of state, by default, the selector is ",(0,i.kt)("inlineCode",{parentName:"td"},"identity")," and so the state is of shape ",(0,i.kt)("inlineCode",{parentName:"td"},"{status, args, data, timestamp}"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"abort")),(0,i.kt)("td",{parentName:"tr",align:null},"Abort the current pending run")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"source")),(0,i.kt)("td",{parentName:"tr",align:null},"The ",(0,i.kt)("inlineCode",{parentName:"td"},"Source")," object of the subscribed async state instance, could be reused for further subscription or run")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("s",null,(0,i.kt)("inlineCode",{parentName:"td"},"payload"))),(0,i.kt)("td",{parentName:"tr",align:null},"The async state instance's payload (should be removed in the future, because there is no point of exposing this property)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"lastSuccess")),(0,i.kt)("td",{parentName:"tr",align:null},"The last registered success")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"replaceState")),(0,i.kt)("td",{parentName:"tr",align:null},"Imperatively and instantly replace state with the given value (accepts a callback receiving the old state), the status may be specified as a second parameter, it defaults to ",(0,i.kt)("inlineCode",{parentName:"td"},"success"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"mergePayload")),(0,i.kt)("td",{parentName:"tr",align:null},"Imperatively merge the payload of the subscribed async state instance with the object in first parameter")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"invalidateCache")),(0,i.kt)("td",{parentName:"tr",align:null},"Invalidates the cache with this producer, ",(0,i.kt)("inlineCode",{parentName:"td"},"invalidateCache(cacheKey?: string) => void"),", it either removes the cached key data or the whole cache if this parameter is undefined")))),(0,i.kt)("p",null,"We bet in this shape because it provides the key for further subscriptions,\nthe current state with status, data and the\narguments that produced it. ",(0,i.kt)("inlineCode",{parentName:"p"},"run")," runs the subscribed async state, to abort it invoke ",(0,i.kt)("inlineCode",{parentName:"p"},"abort"),". The ",(0,i.kt)("inlineCode",{parentName:"p"},"lastSuccess"),"\nholds for you the last succeeded value."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"selector")," as config in for ",(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState")," allows you to subscribe to just\na small portion of the state while choosing when to trigger a rerender,\nthis is an important feature to be at the core of the library."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Calling the ",(0,i.kt)("inlineCode",{parentName:"p"},"run")," function when the status is ",(0,i.kt)("inlineCode",{parentName:"p"},"pending")," will result in aborting\nthe previous instantly, and start a new one."))),(0,i.kt)("h2",{id:"examples"},"Examples"),(0,i.kt)("p",null,"Let's now make some examples using ",(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'import {useAsyncState} from "react-async-states";\n\n// later and during render\n\n// executes currentUserPromise on mount\nconst {state: {data, status}} = useAsyncState({key: "current-user", producer: currentUserPromise, lazy: false});\n\n// subscribes to transactions list state\nconst {state: {data: transactions, status}} = useAsyncState("transactions");\n\n// injects the users list state\nconst {state: {data, status}} = useAsyncState({key: "users-list", producer: usersListPromise, lazy: false, payload: {storeId}, hoistToProvider: true});\n\n// forks the list of transactions for another store (for preview for example)\n// this will create another async state issued from users-list -with a new key (forked)- without impacting its state\nconst {state: {data, status}} = useAsyncState({key: "users-list", payload: {anotherStoreId}, fork: true});\n\n// reloads the user profile each time the match params change\n// this assumes you have a variable in your path\n// for example, once the user chooses a profile, just redirect to the new url => matchParams will change => refetch as non lazy\nconst matchParams = useParams();\nconst {state} = useAsuncState({\n  ...userProfilePromiseConfig, // (key, producer), or take only the key if hoisted and no problem impacting the state\n  lazy: false,\n  payload: {matchParams}\n}, [matchParams]);\n\n// add element to existing state via replaceState\nconst {state: {data: myTodos}, replaceState} = useAsyncState("todos");\nfunction addToDo(data) {\n  replaceState(old => ({...old, [data.id]: data}));\n}\n\n// add element to existing state via run (may be a reducer)\n// run in this case acts like a `dispatch`\nconst {state: {data: myTodos}, run} = useAsyncState("todos");\n\nfunction addTodo(data) {\n  run({type: ADD_TODO, payload: data});\n}\nfunction removeTodo(id) {\n  run({type: REMOVE_TODO, payload: id});\n}\n\n// a standalone async state (even inside provider, not hoisted nor forked => standalone)\nuseAsyncState({\n  key: "not_in_provider",\n  payload: {\n    delay: 2000,\n    onSuccess() {\n      showNotification();\n    }\n  },\n  producer(props) {\n    timeout(props.payload.delay)\n    .then(function callSuccess() {\n      if (!props.isAborted()) {\n        // notice that we are taking onSuccess from payload, not from component\'s closure\n        // that\'s the way to go, this creates a separation of concerns\n        // and your producer may be extracted outisde this file, and will be easier to test\n        // but in general, please avoid code like this, and make it like an effect reacting to a value\n        // (the state data for example)\n        props.payload.onSuccess();\n      }\n    })\n  }\n});\n\n// hoists a controlled form to provider\nuseAsyncState({\n  key: "some-form",\n  producer(props) {\n    const [name, value] = props.args;\n    if (!name) {\n      return props.lastSuccess.data;\n    }\n    return {...props.lastSuccess.data, [name]: value};\n  },\n  hoistToProvider: true,\n  initialValue: {}\n});\n// later\n<Input name="username" />\n<Input name="password" />\n<Input name="phoneNumber" />\n// where\nfunction Input({name, ...rest}) {\n  const {state, run} = useAsyncState({\n    key: "login-form",\n    selector: state => state.data[name],\n  }, [name]);\n  return //...\n}\n\n')),(0,i.kt)("h2",{id:"useasyncstate-configuration"},(0,i.kt)("inlineCode",{parentName:"h2"},"useAsyncState")," configuration"),(0,i.kt)("h3",{id:"string-as-the-key"},(0,i.kt)("inlineCode",{parentName:"h3"},"string")," as the ",(0,i.kt)("inlineCode",{parentName:"h3"},"key")),(0,i.kt)("p",null,"You may use a ",(0,i.kt)("inlineCode",{parentName:"p"},"string")," as the first parameter to ",(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState"),"."),(0,i.kt)("p",null,"The key is detailed ",(0,i.kt)("a",{parentName:"p",href:"#key"},"here"),"."),(0,i.kt)("h3",{id:"source-object"},(0,i.kt)("inlineCode",{parentName:"h3"},"Source")," object"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState")," accepts a ",(0,i.kt)("inlineCode",{parentName:"p"},"Source")," object as first parameter."),(0,i.kt)("p",null,"Read about it ",(0,i.kt)("a",{parentName:"p",href:"#source"},"here"),"."),(0,i.kt)("h3",{id:"producer-function"},(0,i.kt)("inlineCode",{parentName:"h3"},"Producer")," function"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState")," accepts a ",(0,i.kt)("inlineCode",{parentName:"p"},"Producer")," function as first parameter."),(0,i.kt)("p",null,"Read about it ",(0,i.kt)("a",{parentName:"p",href:"#/docs/api/producer-function"},"here"),"."),(0,i.kt)("p",null,"You can use it like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"// creates a new non shared state with myProducer as producer\nuseAsyncState(myProducer, [...deps]);\n\n// creates a new non shared state from the given function\nuseAsyncState(function() {\n  // do something\n  // return state value or promise or thenable\n}, [...deps]);\n\n// creates a new non shared state from the given async/await function\nuseAsyncState(async function() {\n  // do something\n  await stuff;\n  // return state value or promise or thenable\n  \n  // or even\n  return await stuff;\n}, [...deps]);\n\n// creates a new non shared state from the given generator\nuseAsyncState(function* myProducer() {\n  // do something\n  yield stuff;\n  // return state value or promise or thenable\n\n  // or even\n  return yield stuff;\n  \n  // or\n  throw e;\n}, [...deps]);\n")),(0,i.kt)("h2",{id:"configuration-object"},(0,i.kt)("inlineCode",{parentName:"h2"},"Configuration")," object"),(0,i.kt)("h3",{id:"key"},(0,i.kt)("inlineCode",{parentName:"h3"},"key")),(0,i.kt)("p",null,"The key received by ",(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState")," works as the following:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"If inside a provider",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"If the ",(0,i.kt)("inlineCode",{parentName:"li"},"key")," matches something in the provider",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"If neither ",(0,i.kt)("inlineCode",{parentName:"li"},"hoistToProvider")," nor ",(0,i.kt)("inlineCode",{parentName:"li"},"fork")," is truthy,\nthen we are ",(0,i.kt)("inlineCode",{parentName:"li"},"listening")," to a state"),(0,i.kt)("li",{parentName:"ul"},"If ",(0,i.kt)("inlineCode",{parentName:"li"},"hoistToProvider = true"),", attempts to override it with a new\ncreated state from given ",(0,i.kt)("inlineCode",{parentName:"li"},"producer")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"hositToProviderConfiguration"),"."),(0,i.kt)("li",{parentName:"ul"},"If ",(0,i.kt)("inlineCode",{parentName:"li"},"fork = true"),", forks from the matched state."))),(0,i.kt)("li",{parentName:"ul"},"If there is no such a ",(0,i.kt)("inlineCode",{parentName:"li"},"key")," in the provider",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"If ",(0,i.kt)("inlineCode",{parentName:"li"},"hoistToProvider = true"),", hoists the created state with the given\n",(0,i.kt)("inlineCode",{parentName:"li"},"producer")," and other related properties."))))),(0,i.kt)("li",{parentName:"ul"},"If outside the provider, a new state is created.")),(0,i.kt)("p",null,"So as a recap, the key is needed:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"When defining a state"),(0,i.kt)("li",{parentName:"ul"},"When trying to subscribe to a state (while adding hoist, listen or fork)")),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The previous assumptions are related to ",(0,i.kt)("inlineCode",{parentName:"p"},"key")," only. If a ",(0,i.kt)("inlineCode",{parentName:"p"},"Source")," object is\nprovided, it would just perform ",(0,i.kt)("inlineCode",{parentName:"p"},"subscription")," to it."))),(0,i.kt)("p",null,"The following snippets will give you a good idea of how to ",(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {useAsyncState} from "react-async-states";\n\n// ASSUMING YOU ARE INSIDE PROVIDER\n\n// creates a state with `my-key` as key and undefined as producer\nuseAsyncState("my-key");\n\n// creates a state with `my-key` as key and undefined as myProducer\nuseAsyncState({\n  key: "my-key",\n  producer: myProducer,\n});\n\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {useAsyncState} from "react-async-states";\n\n// ASSUMING YOU ARE OUTSIDE PROVIDER\n\n// listens or waits to the state with `my-key` as key\n// if not found, it will return empty data and wait for it given key to be hoisted\nuseAsyncState("my-key");\n\n// listens or waits to the state with `my-key` as key, plus\n// the `producer` property is ignored\nuseAsyncState({\n  key: "my-key",\n  producer: myProducer,\n});\n\n// listens or waits to the state with `my-key` as key, plus\n// if not found, it will create it with the given producer and hoists it\n// to provider\nuseAsyncState({\n  key: "my-key",\n  producer: myProducer,\n  hoistToProvider: true,\n});\n\n// defines a new state with the given producer and hoists it to provider\n// if an async state exists with the same key, it tries to dispose it\n//    if the dispose passes, the old state is overrided \n//  or else, the a new instance is created and given `my-key` and added to\n// provider, and then its watchers are notified (components waiting).\nuseAsyncState({\n  key: "my-key",\n  producer: myProducer,\n  hoistToProvider: true,\n  hoistToProviderConfig: {\n    override: true,\n  }\n});\n\n// the key property is completely ignored\nuseAsyncState({\n  key: "my-key",\n  source: mySource, // assuming this is a valid source object, or else it is like undefined\n});\n\n')),(0,i.kt)("h3",{id:"producer"},(0,i.kt)("inlineCode",{parentName:"h3"},"producer")),(0,i.kt)("p",null,"The production has its ",(0,i.kt)("a",{parentName:"p",href:"/docs/api/producer-function"},"own detailed documentation in this link"),"."),(0,i.kt)("p",null,"If the hook is used like this: ",(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState(producer)")," it will create a new\nnon-shared state with the given producer and subscribes to it."),(0,i.kt)("p",null,"It can be used like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {useAsyncState} from "react-async-states";\n\nuseAsyncState({\n  // the producer property can take any of the supported forms\n  producer: async function (props) {...},\n});\n')),(0,i.kt)("h3",{id:"initialvalue"},(0,i.kt)("inlineCode",{parentName:"h3"},"initialValue")),(0,i.kt)("p",null,"This property is relevant each time creating a new state, and serves as\nthe initializing value of the state (either a value or a function)."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {useAsyncState} from "react-async-states";\n\nuseAsyncState({\n  initialValue: 0,\n  producer: counterProducer,\n});\n')),(0,i.kt)("h3",{id:"source"},(0,i.kt)("inlineCode",{parentName:"h3"},"source")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Source")," objects are retrieved either from ",(0,i.kt)("a",{parentName:"p",href:"/docs/api/create-source"},(0,i.kt)("inlineCode",{parentName:"a"},"createSource")),"\nor from the return value of ",(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState"),"."),(0,i.kt)("p",null,"It may be used like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {createSource, useAsyncState} from "react-async-states";\n\nconst mySource = createSource("my-key", myProducer, myConfig);\n\n// later\n\n// subscribes to the given state\nuseAsyncState(mySource);\n\n// subscribes to the given state\n// all other creation/listen properties are ignored, like key, producer, hoist\nuseAsyncState({source: mySource});\n\n// forks the given state\n// all other creation/listen properties are ignored, like key, producer, hoist\nuseAsyncState({source: mySource, fork: true});\n')),(0,i.kt)("h3",{id:"condition"},(0,i.kt)("inlineCode",{parentName:"h3"},"condition")),(0,i.kt)("p",null,"This property is used only when ",(0,i.kt)("inlineCode",{parentName:"p"},"lazy")," is ",(0,i.kt)("inlineCode",{parentName:"p"},"falsy"),".\nIf the ",(0,i.kt)("inlineCode",{parentName:"p"},"condition")," is truthy, the ",(0,i.kt)("inlineCode",{parentName:"p"},"producer"),"\nassociated with the subscription will run."),(0,i.kt)("h3",{id:"lane"},(0,i.kt)("inlineCode",{parentName:"h3"},"lane")),(0,i.kt)("p",null,"Lanes are a concept in the library that let's you group states with same producer:"),(0,i.kt)("p",null,"A lane is a totally separate state instance, with own pending state,\nand own payload and subscribers,  and with the same ",(0,i.kt)("inlineCode",{parentName:"p"},"config")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"producer")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"cache"),".\nIt is very similar to forks, but forking means a separated state instance\nnot sharing anything and don't belong to anything."),(0,i.kt)("p",null,"A lane may have multiple subscribers and its own lifecycle."),(0,i.kt)("p",null,"You can manipulate lanes from all the places in the library."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {useAsyncState} from "react-async-states";\n\n// subscribes to `city-casablanca` lane in the state defined in `weatherSource`\nuseAsyncState({\n  source: weatherSource,\n  payload: { lat, lng },\n  lane: "city-casablanca"\n});\n\n\n// subscribes to `user-details-me` lane in the state defined in `userDetails`\nuseAsyncState({\n  source: userDetails,\n  payload: { userId: "me" },\n  lane: "user-details-me"\n});\n\n\n// subscribes to `user-details-123` lane in the state defined in `userDetails`\nuseAsyncState({\n  source: userDetails,\n  payload: { userId: "123" },\n  lane: "user-details-123"\n});\n\n// subscribes to `references-company-types` lane in the state defined in `references`\nuseAsyncState({\n  source: references,\n  payload: { userId: "123" },\n  lane: "references-company-types"\n});\n\n')),(0,i.kt)("h3",{id:"lazy"},(0,i.kt)("inlineCode",{parentName:"h3"},"lazy")),(0,i.kt)("p",null,"If this property is set to ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),", when the dependencies change,\nthe ",(0,i.kt)("inlineCode",{parentName:"p"},"producer")," will run if condition is ",(0,i.kt)("inlineCode",{parentName:"p"},"truthy"),"."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If several subscriptions are made to the same state and all of them set ",(0,i.kt)("inlineCode",{parentName:"p"},"lazy"),"\nto false, then they may ",(0,i.kt)("inlineCode",{parentName:"p"},"abort")," each other if they have the same dependencies."),(0,i.kt)("p",{parentName:"div"},"Pay close attention to this exact use case."))),(0,i.kt)("h3",{id:"fork"},(0,i.kt)("inlineCode",{parentName:"h3"},"fork")),(0,i.kt)("p",null,"If this property is true, it will fork the subscribed state with the given ",(0,i.kt)("inlineCode",{parentName:"p"},"forkConfig"),"."),(0,i.kt)("h3",{id:"forkconfig"},(0,i.kt)("inlineCode",{parentName:"h3"},"forkConfig")),(0,i.kt)("p",null,"A configuration object containing the following:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Property"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Default Value"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"key")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"string")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"undefined")),(0,i.kt)("td",{parentName:"tr",align:null},"The key that will be given to the created state (the forked one)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"keepState")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"boolean")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"undefined")),(0,i.kt)("td",{parentName:"tr",align:null},"Whether to keep the state from the original while forking")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"keepCache")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"boolean")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"undefined")),(0,i.kt)("td",{parentName:"tr",align:null},"Whether to keep the cache from the original while forking")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {useAsyncState} from "react-async-states";\n\n// forks from a Source object and copies its cache\nuseAsyncState({\n  fork: true,\n  source: mySource,\n  forkConfig: {\n    keepCache: true,\n  }\n})\n\n// forks from the subscribed state (by key constraints)\nuseAsyncState({\n  fork: true,\n  key: "some-key",\n  forkConfig: {\n    key: "my-key",\n  }\n})\n')),(0,i.kt)("h3",{id:"hoisttoprovider"},(0,i.kt)("inlineCode",{parentName:"h3"},"hoistToProvider")),(0,i.kt)("p",null,"This property is relevant only if inside a provider,\nIf set to true, it will ",(0,i.kt)("inlineCode",{parentName:"p"},"hoist")," the state with the given ",(0,i.kt)("inlineCode",{parentName:"p"},"hoistToProviderConfig"),"."),(0,i.kt)("h3",{id:"hoisttoproviderconfig"},(0,i.kt)("inlineCode",{parentName:"h3"},"hoistToProviderConfig")),(0,i.kt)("p",null,"A configuration object containing the following:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Property"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Default Value"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"override")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"boolean")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"undefined")),(0,i.kt)("td",{parentName:"tr",align:null},"Whether to override the existing state with the same key")))),(0,i.kt)("h3",{id:"selector"},(0,i.kt)("inlineCode",{parentName:"h3"},"selector")),(0,i.kt)("p",null,"The selector that selects data from your state.\nIt is a function with the following in order parameters:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"state")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"State<T>")),(0,i.kt)("td",{parentName:"tr",align:null},"The current state")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"lastSuccess")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"State<T>")),(0,i.kt)("td",{parentName:"tr",align:null},"The last registered state (may be equal to state if the current state is success)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"cache")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"Cache<T>")),(0,i.kt)("td",{parentName:"tr",align:null},"The cache associated to this state")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"// extend the given state\nimport {State, AsyncStateStatus, useAsyncState, UseAsyncState} from \"react-async-states\";\n\n// syncSelector\n// if you want that your state is always synchronous\n// you may be interested only by the data inside the state\nfunction syncSelector(state: State<T>): E {\n  return state.data;\n}\n\n// this selector throws if the state is error so it is leveraged to the nearest\n// error boundary\nfunction errorBoundarySelector(state: State<T>): E {\n  // assuming you have an error boundary\n  if (state.status === AsyncStateStatus.error) {\n    throw state.data;\n  }\n  return state;\n}\n\n// this selector gives the last success data\nfunction keepPreviousDataSelector(state: State<T>, lastSuccess): E {\n  if (state.status === AsyncStateStatus.pending) {\n    return {\n      ...state,\n      data: lastSuccess.data,\n    };\n  }\n  return state;\n}\n\n// select from cache selector\nfunction errorBoundarySelector(state, lastSuccess, cache): E {\n  // this requires the cache to be enabled\n  if (cache['user-1-details']) {\n    return cache['user-1-details']; // or cache['user-1-details'].data depending or your needs\n  }\n  return state;\n}\n\nfunction lazyDeveloperSelector(state: State<T>) {\n  return {\n    ...state,\n    isError: state.status === AsyncStateStatus.error,\n    isPending: state.status === AsyncStateStatus.pending,\n    isWeird: false,\n    ...\n  }\n}\n\nconst result: UseAsyncState<T, E> = useAsyncState({\n  key,\n  selector: mySelector,\n})\n\n")),(0,i.kt)("h3",{id:"areequal"},(0,i.kt)("inlineCode",{parentName:"h3"},"areEqual")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"areEqual")," function is used to determine whether the previous state value equals\nthe selected value from the new state.\nThis comparison occurs in a callback from React's ",(0,i.kt)("inlineCode",{parentName:"p"},"useState"),". If they are equal\nbased on this function, the old value is used (so react won't trigger an update).\nIf they are different, the new value is used and react will perform a rerender."),(0,i.kt)("h3",{id:"runeffect"},(0,i.kt)("inlineCode",{parentName:"h3"},"runEffect")),(0,i.kt)("p",null,"Defines the effect to apply on the producer while running."),(0,i.kt)("p",null,"This property is only relevant when creating a new state."),(0,i.kt)("p",null,"There are two types of run effects:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"debouce"),": or ",(0,i.kt)("inlineCode",{parentName:"li"},"delay"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"takeLast")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"takeLatest")," and means take the last\nregistered run in the configured duration."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"throttle"),": or ",(0,i.kt)("inlineCode",{parentName:"li"},"takeFirst")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"takeLeading")," and means take the first ever run\nin the duration.")),(0,i.kt)("h3",{id:"runeffectdurationms"},(0,i.kt)("inlineCode",{parentName:"h3"},"runEffectDurationMs")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"runEffectDurationMs")," : the duration of the effect."),(0,i.kt)("p",null,"Here is a working example of debouncing the ",(0,i.kt)("inlineCode",{parentName:"p"},"getClientProducer")," while typing:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'const { run, state } = useAsyncState({\n  producer: getClientProducer,\n\n  runEffect: "debounce",\n  runEffectDurationMs: 500,\n});\n\n// later:\n<input placeholder="User id 1-10" onChange={(e) => run(e.target.value)} />\n\n')),(0,i.kt)("h3",{id:"skippendingdelayms"},(0,i.kt)("inlineCode",{parentName:"h3"},"skipPendingDelayMs")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"skipPendingDelayMs")," : The duration under which a state update with a pending\nstatus may be skipped. The component in this case won't render with a pending\nstatus if it gets updated to something else under that delay."),(0,i.kt)("p",null,"Here is a working example of debouncing the ",(0,i.kt)("inlineCode",{parentName:"p"},"getClientProducer")," while typing:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"// the state won't go to pending if the fetch goes under 300ms!\nconst { run, state } = useAsyncState({\n  skipPendingDelayMs: 300,\n  producer: getClientProducer,\n});\n\n")),(0,i.kt)("h3",{id:"resetstateondispose"},(0,i.kt)("inlineCode",{parentName:"h3"},"resetStateOnDispose")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"resetStateOnDispose")," : Defines whether to reset the state to the initial value\nwhen all subscribers unsubcribe, or to keep the current value."),(0,i.kt)("p",null,"The default value is ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," and the library will reset the state to its initial\nvalue by default."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"// the state won't go to pending if the fetch goes under 300ms!\nconst { run, state } = useAsyncState({\n  resetStateOnDispose: false,\n  producer: getClientProducer,\n});\n\n\n// or\n\ncreateSource(key, producer, {resetStateOnDispose: false});\n")),(0,i.kt)("h3",{id:"cacheconfig"},(0,i.kt)("inlineCode",{parentName:"h3"},"cacheConfig")),(0,i.kt)("p",null,"This property is only relevant when ",(0,i.kt)("inlineCode",{parentName:"p"},"creating")," a new state (along with hoist...)."),(0,i.kt)("p",null,"It determines the cache configurations:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Property"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"enabled")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"boolean")),(0,i.kt)("td",{parentName:"tr",align:null},"Whether to enable cache or not")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"hash")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(args?: any[], payload?: {[id: string]: any} or null) => string")),(0,i.kt)("td",{parentName:"tr",align:null},"a function to calculate a hash for a producer run (from args and payload)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"getDeadline")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(currentState: State<T>) => number")),(0,i.kt)("td",{parentName:"tr",align:null},"returns the deadline after which the cache is invalid")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"load")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"() => {[id: AsyncStateKey]: CachedState<T>}")),(0,i.kt)("td",{parentName:"tr",align:null},"loads the cached data when the async state instance is created")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"persist")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(cache: {[id: AsyncStateKey]: CachedState<T>}) => void")),(0,i.kt)("td",{parentName:"tr",align:null},"a function to persist the whole cache, called when state is updated to success")))),(0,i.kt)("h3",{id:"events"},(0,i.kt)("inlineCode",{parentName:"h3"},"events")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"events")," property defines handlers that will be invoked."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"export type UseAsyncStateEvents<T> = {\n  change?: UseAsyncStateEventFn<T> | UseAsyncStateEventFn<T>[],\n  subscribe?: ((props: SubscribeEventProps<T>) => CleanupFn) | ((props: SubscribeEventProps<T>) => CleanupFn)[],\n}\n")),(0,i.kt)("p",null,"The supported events are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"subscribe"),": invoked when a subscription to a state occurs."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"change"),": invoked whenever the state value changes. Always invoked, even if\n",(0,i.kt)("inlineCode",{parentName:"li"},"areEqual")," is truthy.")),(0,i.kt)("h4",{id:"subscribe"},(0,i.kt)("inlineCode",{parentName:"h4"},"subscribe")),(0,i.kt)("p",null,"This event handler is called once a subscription to a state occurs."),(0,i.kt)("p",null,"This should be mainly used to attach event listeners that may ",(0,i.kt)("inlineCode",{parentName:"p"},"run")," the producer\nor do another side effect."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"// this is how the library invokes the subscribe events.\nunsubscribe = subscribe({\n    run,\n    mode,\n    invalidateCache,\n    getState: () => asyncState.currentState,\n})\n")),(0,i.kt)("p",null,"This functions returns its cleanup (if available.)"),(0,i.kt)("p",null,"Here is an example of how to use it to run your producer once your window gets focused:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const {state: {status, data}, lastSuccess, abort} = useAsyncState({\n    lazy: false,\n    payload: {matchParams: params},\n    key: demoAsyncStates.getUser.key,\n    events: {\n      subscribe: ({getState, run, invalidateCache}) => {\n        const state = getState();\n        function onFocus() {\n          if (shouldInvalidateCacheAndRun()) {\n            invalidateCache();\n            run();\n          }\n        }\n        window.addEventListener("focus", onFocus);\n        return () => window.removeEventListener("focus", onFocus);\n      },\n    }\n  }, [params]);\n')),(0,i.kt)("h4",{id:"change"},(0,i.kt)("inlineCode",{parentName:"h4"},"change")),(0,i.kt)("p",null,"This event handler is called when the state changes."),(0,i.kt)("p",null,'Please note that these handlers are invoked after subscription to a state,\nso they will miss any state update when "',(0,i.kt)("inlineCode",{parentName:"p"},"not subscribed"),'". Although, this\nmay change in the future and also the events function could be granted the producer\npower.'),(0,i.kt)("p",null,"This should be mainly used to run side effects after a ",(0,i.kt)("inlineCode",{parentName:"p"},"status")," change."),(0,i.kt)("p",null,"Here are some examples of how to use it:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const {state: {status, data}, lastSuccess, abort} = useAsyncState({\n    lazy: false,\n    payload: {matchParams: params},\n    key: demoAsyncStates.updateUser.key,\n    events: {\n      change: ({state}) => {\n        if (state.status === "success") {\n          refreshList();\n          closeModal();\n        }\n      },\n    }\n  }, [params]);\n')),(0,i.kt)("h2",{id:"useasyncstate-dependencies"},(0,i.kt)("inlineCode",{parentName:"h2"},"useAsyncState")," dependencies"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState")," accepts a second parameter that corresponds to the array of its\ndependencies.\nThe default value is empty array rather that undefined."),(0,i.kt)("p",null,"The dependencies are the secure vault over closure variables that you make, so\nalways be sure to add them responsibly."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {useAsyncState} from "react-async-states";\n\nconst params = useParams;\nuseAsyncState(function getUserDetails(props) {\n  doSomethingWith(params)\n  return stateValue;\n}, [\n  params,// whenever params change, recreate the state\n]);\n\n// OR USING PAYLOAD\nfunction callback() {}\nuseAsyncState({\n  payload: {params, callback},\n  producer(props) {\n    const {params} = props.payload;\n    callback();\n  },\n}, [\n  params,\n  callback,\n]);\n')),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Be sure to add relevant component variables used in the subscription as\ndependencies or you will have unwanted behavior and hard to debug/spot bugs."))),(0,i.kt)("h2",{id:"useasyncstate-return-value"},(0,i.kt)("inlineCode",{parentName:"h2"},"useAsyncState")," return value"),(0,i.kt)("h3",{id:"key-1"},(0,i.kt)("inlineCode",{parentName:"h3"},"key")),(0,i.kt)("p",null,"Corresponds to the key of the ",(0,i.kt)("inlineCode",{parentName:"p"},"AsyncState")," instance that you subscribed to."),(0,i.kt)("p",null,"For example, if you choose to fork a state while omitting the fork key, an\nautomatic key will be given. You'll need that ",(0,i.kt)("inlineCode",{parentName:"p"},"key")," or the ",(0,i.kt)("inlineCode",{parentName:"p"},"source")," to be able\nto subscribe to it."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {useAsyncState} from "react-async-states";\n\nconst {key} = useAsyncState();\n')),(0,i.kt)("h3",{id:"source-1"},(0,i.kt)("inlineCode",{parentName:"h3"},"source")),(0,i.kt)("p",null,"This is the same object given by ",(0,i.kt)("a",{parentName:"p",href:"/docs/api/create-source"},(0,i.kt)("inlineCode",{parentName:"a"},"createSource")),"\nand it shall allow further subscription to the state."),(0,i.kt)("p",null,"Why does source and key both exist:"),(0,i.kt)("p",null,"The library doesn't use any global store to keep a reference towards created\nstates, so they will be garbage collected immediately after loosing developer\nreference towards them. THe source object contains the instance of state,\nby providing it back to the library, it knows how unwrap it and perform\nsubscription and/or run it."),(0,i.kt)("p",null,"Plus, ",(0,i.kt)("inlineCode",{parentName:"p"},"createSource")," doesn't need react to work, so it will allow creating\nmodule level states. Also, the library support running producers and states\nfrom almost everywhere in your code base, and it would just work if you provid\na ",(0,i.kt)("inlineCode",{parentName:"p"},"Source")," object."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {useAsyncState} from "react-async-states";\n\nconst {source} = useAsyncState();\n')),(0,i.kt)("h3",{id:"uniqueid"},(0,i.kt)("inlineCode",{parentName:"h3"},"uniqueId")),(0,i.kt)("p",null,"This is only used in development mode and was originally added with the devtools."),(0,i.kt)("h3",{id:"mode"},(0,i.kt)("inlineCode",{parentName:"h3"},"mode")),(0,i.kt)("p",null,"This corresponds to ",(0,i.kt)("inlineCode",{parentName:"p"},"AsyncStateSubscriptionMode")),(0,i.kt)("p",null,"Here is the full list:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'\nenum AsyncStateSubscriptionMode {\n  LISTEN = "LISTEN",\n  HOIST = "HOIST",\n  STANDALONE = "STANDALONE",\n  WAITING = "WAITING",\n  FORK = "FORK",\n  NOOP = "NOOP",\n  SOURCE = "SOURCE",\n  SOURCE_FORK = "SOURCE_FORK",\n  OUTSIDE_PROVIDER = "OUTSIDE_PROVIDER",\n}\n\n')),(0,i.kt)("p",null,"Read more about it ",(0,i.kt)("a",{parentName:"p",href:"/docs/faq/how-the-library-works#how-useasyncstate-subscription-mode-works-"},"here"),"."),(0,i.kt)("p",null,"In general, you would never use this (unless you are a contributor and debugging things)."),(0,i.kt)("h3",{id:"state"},(0,i.kt)("inlineCode",{parentName:"h3"},"state")),(0,i.kt)("p",null,"This is whatever the selector returns:"),(0,i.kt)("p",null,"The selector is described in ",(0,i.kt)("a",{parentName:"p",href:"#selector"},"its own section"),"."),(0,i.kt)("p",null,"The default selector of the library returns the ",(0,i.kt)("inlineCode",{parentName:"p"},"State")," identity, which is\ncomposed of:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Property"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"data")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"T")),(0,i.kt)("td",{parentName:"tr",align:null},"The returned data from the ",(0,i.kt)("inlineCode",{parentName:"td"},"producer function"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"status")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"initial,pending,success,error,aborted")),(0,i.kt)("td",{parentName:"tr",align:null},"The status of the state")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"props")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ProducerProps")),(0,i.kt)("td",{parentName:"tr",align:null},"The argument object that the producer was ran with (the ",(0,i.kt)("inlineCode",{parentName:"td"},"props"),")")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"timestamp")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"number")),(0,i.kt)("td",{parentName:"tr",align:null},"the time (",(0,i.kt)("inlineCode",{parentName:"td"},"Date.now()"),") where the state was constructed")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {State, UseAsyncState, useAsyncState} from "react-async-states";\n\ntype User\n{\n  name: string,\n}\n\nfunction myProducer(): Promise<User> {\n  return fetch(url).then(r => r.json());\n}\n\nfunction userNameSelector(state: State<User>): string | null {\n  return state.status === "success" ? state.data.name : null;\n}\n\n// later:\nconst {state}: UseAsyncState<User> = useAsyncState(myProducer);\n\n\n// state in this case is a string\nconst {state: userName}: UseAsyncState<User, string> = useAsyncState({\n  producer: myProducer,\n  selector: mySelector,\n})\n\n\nfunction defaultLibrarySelector(...args): State<T> {\n  return args[0];\n}\n\n')),(0,i.kt)("h3",{id:"read"},(0,i.kt)("inlineCode",{parentName:"h3"},"read")),(0,i.kt)("p",null,"This function enable the react's concurrent feature: ",(0,i.kt)("inlineCode",{parentName:"p"},"Component suspension"),".\nThat works with ",(0,i.kt)("inlineCode",{parentName:"p"},"Suspense"),". So calling read requires you to have a ",(0,i.kt)("inlineCode",{parentName:"p"},"Suspense"),"\nup in your tree."),(0,i.kt)("p",null,"This function warns if the used react version doesn't support concurrent features."),(0,i.kt)("p",null,"You can pass this function to a child component that will read the data and\nsuspend if pending."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'import {Suspense} from "react";\nimport {useAsyncState} from "react-async-states";\n\n\nfunction UserDetails({userId}) {\n  \n  const {read, state} = useAsyncState({\n    lazy: false,\n    payload: {userId},\n    source: userDetailsPageSource,\n  }, [userId]);\n  \n  \n  return (\n    <Suspense fallback={<Skeleton userId={userId} />}>\n      <ErrorBoundary>\n        <UserDetails read={read} />\n      </ErrorBoundary>\n    </Suspense>\n  );\n}\n\nfunction UserDetails({read}) {\n  // when pending, this line will throw a Promise that react will catch\n  // and display Suspense\'s fallback until present\n  const {data, status} = read();\n  \n  const isError = status === "error";\n  const isSuccess = status === "success";\n  const isInitial = status === "initial";\n  const isAborted = status === "success";\n  if (isError && shouldThrowFromError(data)) {\n    throw data;\n  }\n  \n  return (\n    // build the UI based on the statuses you need\n  );\n}\n\n')),(0,i.kt)("h3",{id:"run"},(0,i.kt)("inlineCode",{parentName:"h3"},"run")),(0,i.kt)("p",null,"This function triggers the producer run."),(0,i.kt)("p",null,"It gives to the producer whatever it was called with as ",(0,i.kt)("inlineCode",{parentName:"p"},"args"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'\n// calling run like this\nrun(1, 2, 3);\n// should be reflected like this for the producer when running:\nprops = {\n  // ...\n  args: [1, 2, 3]\n  // ...\n}\n        \n// calling run like this\nrun(1, 2, 3);\n// should be reflected like this for the producer when running:\nprops = {\n  // ...\n  args: [1, 2, 3]\n  // ...\n}\n\n// calling run like this\nrun();\n// should be reflected like this for the producer when running:\nprops = {\n  // ...\n  args: []\n  // ...\n}\n\n// calling run like this\nrun("increment", 1);\n// should be reflected like this for the producer when running:\nprops = {\n  // ...\n  args: ["increment", 1]\n  // ...\n}\n\n// calling run like this\nrun(1, {name: "John"});\n// should be reflected like this for the producer when running:\nprops = {\n  // ...\n  args: [1, {name: "John"}]\n  // ...\n}\n\n')),(0,i.kt)("h3",{id:"abort"},(0,i.kt)("inlineCode",{parentName:"h3"},"abort")),(0,i.kt)("p",null,"the ",(0,i.kt)("inlineCode",{parentName:"p"},"abort")," function when called, if the status is pending, it would trigger\nthe abort, and execute all registered abort callbacks."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'import {useAsyncState} from "react-async-states";\n\nconst {state: {status}, abort} = useAsyncState("my-key");\n\n{status === "pending" && <Button onClick={() => abort("user_action")}>Abort</Button>}\n')),(0,i.kt)("h3",{id:"invalidatecache"},(0,i.kt)("inlineCode",{parentName:"h3"},"invalidateCache")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"invalidateCache: (cacheKey?: string) => void\n")),(0,i.kt)("p",null,"Takes an optional ",(0,i.kt)("inlineCode",{parentName:"p"},"cacheKey")," parameter that:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"If provided, will delete the cache entry from cache."),(0,i.kt)("li",{parentName:"ul"},"If not provided, will delete the whole cache.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'import {useAsyncState} from "react-async-states";\n\nconst {invalidateCache} =  useAsyncState({\n  source: usersPageSource,\n});\n\n<Button onClick={() => {\n  invalidateCache();\n  run()\n}}>Reset search</Button>\n')),(0,i.kt)("h3",{id:"mergepayload"},(0,i.kt)("inlineCode",{parentName:"h3"},"mergePayload")),(0,i.kt)("p",null,"The payload that the producer returns is the payload issued from all subscribers,\nand the one from provider, and the one that this function adds:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {useAsyncState} from "react-async-states/src";\n\nconst {mergePayload} = useAsyncState();\n\nmergePayload({userId: 1, isNew: false});\n\n// payload is {userId: 1, isNew: false}\n\nmergePayload({count: 3, userId: 5});\n\n// payload is {count: 3, userId: 5, isNew: fale}\n')),(0,i.kt)("h3",{id:"replacestate"},(0,i.kt)("inlineCode",{parentName:"h3"},"replaceState")),(0,i.kt)("p",null,"replaceState is of type : ",(0,i.kt)("inlineCode",{parentName:"p"},"StateUpdater"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"type StateUpdater<T> = (\n  updater: T | StateFunctionUpdater<T>,\n  status?: AsyncStateStatus\n) => void;\n")),(0,i.kt)("p",null,"It just puts a value as the current state."),(0,i.kt)("p",null,"We don't believe you will use it."),(0,i.kt)("h3",{id:"lastsuccess"},(0,i.kt)("inlineCode",{parentName:"h3"},"lastSuccess")),(0,i.kt)("p",null,"This points to the last state with status ",(0,i.kt)("inlineCode",{parentName:"p"},"success"),"."),(0,i.kt)("p",null,"So if state is actually with a success state, they are the same object."),(0,i.kt)("p",null,"You can use it if you want to be sure in a component that you interact with\na state of type success all the time:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'import {useAsyncState} from "react-async-states";\n\nconst {state: {status, props, data}, lastSuccess} = useAsyncState(myConfig);\n\n// You can think of the following UI, that\n// always display the data in the background\n// when pending or error it just displays an error on top of it\n<MyContainer >\n  <MyData data={lastSuccess} />\n  <ErrorOverlay data={data} visible={status === "error"} />\n  <PendingOverlay data={props} visible={status === "pending"} />\n< /MyContainer>\n')),(0,i.kt)("h2",{id:"other-hooks"},"Other hooks"),(0,i.kt)("p",null,"For convenience, we've added many other hooks with ",(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState")," to help inline most of the situations: They inject\na configuration property which may facilitate using the library:"),(0,i.kt)("p",null,"The following are all hooks with the same signature as ",(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState"),", but each predefines something in the configuration:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"useAsyncState.auto"),": adds ",(0,i.kt)("inlineCode",{parentName:"li"},"lazy: false")," to configuration"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"useAsyncState.lazy"),": adds ",(0,i.kt)("inlineCode",{parentName:"li"},"lazy: true")," to configuration"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"useAsyncState.fork"),": adds ",(0,i.kt)("inlineCode",{parentName:"li"},"fork: true")," to configuration"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"useAsyncState.hoist"),": adds ",(0,i.kt)("inlineCode",{parentName:"li"},"hoistToProvider: true")," to configuration"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"useAsyncState.hoistAuto"),": adds ",(0,i.kt)("inlineCode",{parentName:"li"},"lazy: false, hoistToProvider: true")," to configuration"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"useAsyncState.forkAudo"),": adds ",(0,i.kt)("inlineCode",{parentName:"li"},"lazy: false, fork: true")," to configuration")),(0,i.kt)("p",null,"The following snippets results from the previous hooks:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"// automatically fetches the user's list when the search url changes\nconst {state: {status, data}, run, abort} = useAsyncState.auto(DOMAIN_USER_PRODUCERS.list.key, [search]);\n// automatically fetches user 1 and selects data\nconst {state: user1} = useAsyncState.auto({source: user1Source, selector: s => s.data});\n// automatically fetches user 2 and selects its name\nconst {state: user2} = useAsyncState.auto({source: user2Source, selector: name});\n// automatically fetches user 3 and hoists it to provider and selects its name\nconst {state: user3} = useAsyncState.hoistAuto({source: userPayloadSource, payload: {userId: 3}, selector: name})\n// forks userPayloadSource and runs it automatically with a new payload and selects the name from result\nconst {state: user4} = useAsyncState.forkAuto({source: userPayloadSource, payload: {userId: 4}, selector: name})\n")),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"To suspend a component in concurrent mode,\njust call the ",(0,i.kt)("inlineCode",{parentName:"p"},"read")," function returned by ",(0,i.kt)("inlineCode",{parentName:"p"},"useAsyncState")))))}m.isMDXComponent=!0},876:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(2784);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=d(n),m=r,k=c["".concat(l,".").concat(m)]||c[m]||p[m]||i;return n?a.createElement(k,o(o({ref:t},u),{},{components:n})):a.createElement(k,o({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var d=2;d<i;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"}}]);